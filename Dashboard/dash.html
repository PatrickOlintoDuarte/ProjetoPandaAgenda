<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Panda Fibra - Vagas por Data</title>
  <link rel="stylesheet" href="dash.css"/>
  <style>
    .hidden{display:none!important}
    #appErrors{
      position:fixed;left:1rem;right:1rem;bottom:1rem;z-index:9999;
      background:#2b2730;color:#fff;border:1px solid #ff4d4f;border-radius:10px;
      box-shadow:0 8px 24px rgba(0,0,0,.2);padding:12px 16px;display:none
    }
    #appErrors pre{white-space:pre-wrap;margin:6px 0 0;font-size:.85rem;opacity:.9}
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- Header -->
    <div class="header fade-in">
      <div class="header-content">
        <div class="header-title">
          <h1>Dashboard Panda Fibra</h1>
          <div><div class="header-subtitle">Gestão de Vagas por Data</div></div>
        </div>
        <div class="header-actions">
          <button class="btn btn-google" id="connectGoogleBtn">📅 Conectar Google</button>
          <button class="btn btn-secondary" id="refreshBtn">🔄 Atualizar</button>
          <button class="btn btn-warning" id="reajustarBtn">⚙️ Reajustar Vagas</button>
          <a href="/ProjetoPandaAgenda/index.html" class="btn btn-primary" id="agendaLink">📅 Agenda</a>
        </div>
      </div>
    </div>

    <!-- Google Calendar Status -->
    <div class="calendar-status disconnected" id="calendarStatus">
      <div class="status-icon">🔗</div>
      <div class="status-text">
        <div class="status-title">Google Calendar</div>
        <div class="status-description">Não conectado — mostrando todas as vagas disponíveis</div>
      </div>
    </div>

    <!-- Date Picker -->
    <div class="date-picker-section fade-in">
      <div class="date-picker-header">
        <h2 class="date-picker-title">📅 Selecionar Data</h2>
        <div class="date-controls">
          <input type="date" id="datePicker" class="date-input"/>
          <button class="btn btn-primary" id="buscarVagasBtn">🔍 Buscar Vagas</button>
          <button class="btn btn-secondary" id="hojeBtn">📍 Hoje</button>
        </div>
      </div>
      <div class="selected-date-info" id="selectedDateInfo">
        <div class="selected-date-text" id="selectedDateText">📍 Data selecionada: Hoje</div>
        <div class="date-status" id="dateStatus">Não conectado — todas as vagas estão disponíveis.</div>
      </div>
    </div>

    <!-- Stats -->
    <div class="stats-overview">
      <div class="stat-card total fade-in">
        <div class="stat-header"><span class="stat-title">Total de Vagas</span><span class="stat-icon">🎯</span></div>
        <div class="stat-value" id="totalVagas">0</div>
        <div class="stat-change positive"><span>📊</span><span>Para a data selecionada</span></div>
      </div>
      <div class="stat-card available fade-in">
        <div class="stat-header"><span class="stat-title">Vagas Disponíveis</span><span class="stat-icon">✅</span></div>
        <div class="stat-value" id="vagasDisponiveis">0</div>
        <div class="stat-change positive" id="percentualDisponivel"><span>📈</span><span>0% do total</span></div>
      </div>
      <div class="stat-card occupied fade-in">
        <div class="stat-header"><span class="stat-title">Vagas Agendadas</span><span class="stat-icon">⏳</span></div>
        <div class="stat-value" id="vagasOcupadas">0</div>
        <div class="stat-change negative" id="percentualOcupado"><span>0% do total</span></div>
      </div>
      <div class="stat-card efficiency fade-in">
        <div class="stat-header"><span class="stat-title">Taxa de Ocupação</span><span class="stat-icon">📊</span></div>
        <div class="stat-value" id="taxaOcupacao">0%</div>
        <div class="stat-change" id="statusEficiencia"><span>⚡</span><span>Calculando...</span></div>
      </div>
    </div>

    <!-- Cidades -->
    <div class="cities-section fade-in">
      <div class="section-header"><h2 class="section-title">🏙️ Disponibilidade por Cidade</h2></div>
      <div class="cities-grid" id="citiesGrid"></div>
    </div>

    <!-- FAB -->
    <a href="/index.html" class="fab tooltip" data-tooltip="Abrir Agenda" id="fabLink">📅</a>
  </div>

  <!-- MODAL: Reajuste de Vagas -->
  <dialog class="reajuste-modal" id="reajusteDialog">
    <div class="reajuste-wrap">
      <div class="reajuste-title">⚙️ Reajustar Vagas</div>
      <div class="reajuste-note" id="reajusteNota">—</div>
      <div class="reajuste-field">
        <label for="reajusteCidadeSelect" class="reajuste-label">Cidade / Período</label>
        <select id="reajusteCidadeSelect" class="reajuste-select"></select>
      </div>
      <div class="reajuste-actions">
        <button class="btn btn-ghost" id="reajusteCancelar">Cancelar</button>
        <button class="btn btn-primary" id="reajusteAplicar">Aplicar</button>
      </div>
    </div>
  </dialog>

  <!-- Banner de erros -->
  <div id="appErrors"><strong>Ocorreu um erro</strong><pre id="appErrorsText"></pre></div>

  <!-- Google Identity -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <!-- App -->
  <script src="script.js" defer></script>
</body>
</html>
